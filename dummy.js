// ==UserScript==
// @name         HCC TAMSv3
// @namespace    https://github.com/MasterZeeno
// @version      0.1
// @icon                 data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxNiAxNiI+CiAgICA8cGF0aCBmaWxsPSIjMDAzNjdjIiBkPSJNIDcuNDQxNDA2IDkuNTM5MDYyIEwgNi4xMDE1NjIgOS41MzkwNjIgQyA1LjA5Mzc1IDkuNTg5ODQ0IDQuNDk2MDk0IDkuNzYxNzE5IDQuNDI1NzgxIDExLjUwMzkwNiBMIDQuNDI1NzgxIDE1Ljk0MTQwNiBDIDAuMDUwNzgxMiAxNS45NDE0MDYgMC4wNTA3ODEyIDE1Ljk0MTQwNiAwLjA1MDc4MTIgMTMuOTYwOTM4IEwgMC4wNTA3ODEyIDIuMDYyNSBDIDAuMDUwNzgxMiAwLjA3ODEyNSAwLjA1MDc4MTIgMC4wNzgxMjUgNC40MjU3ODEgMC4wNzgxMjUgTCA0LjQyNTc4MSA0LjUxMTcxOSBDIDQuNDI1NzgxIDYuMTQ0NTMxIDUuMDkzNzUgNi40MjU3ODEgNi4xMDE1NjIgNi40ODQzNzUgTCA5Ljg5ODQzOCA2LjQ4NDM3NSBDIDEwLjkxNzk2OSA2LjQwNjI1IDExLjU3NDIxOSA2LjE0NDUzMSAxMS41NzQyMTkgNC41MTk1MzEgTCAxMS41NzQyMTkgMC4wNzgxMjUgQyAxNS45Njg3NSAwLjA3ODEyNSAxNS45NDkyMTkgMC4wNzgxMjUgMTUuOTQ5MjE5IDIuMDYyNSBMIDE1Ljk0OTIxOSAxMy45NjA5MzggQyAxNS45NDkyMTkgMTUuOTQxNDA2IDE1Ljk2ODc1IDE1Ljk0MTQwNiAxMS41NzQyMTkgMTUuOTQxNDA2IEwgMTEuNTc0MjE5IDExLjUwMzkwNiBDIDExLjU4NTkzOCA5Ljc2MTcxOSAxMC45MTc5NjkgOS41OTc2NTYgOS44OTg0MzggOS41MzkwNjIgWiBNIDcuNDQxNDA2IDkuNTM5MDYyICIgLz4KICAgIDxwYXRoIGZpbGw9IiNjZDAwMDAiIGQ9Ik0gOCAzLjMwODU5NCBDIDcuNDQxNDA2IDMuMzA4NTk0IDcuNDQxNDA2IDIuNDU3MDMxIDguMDIzNDM4IDIuNDU3MDMxIEwgMTAuNzc3MzQ0IDIuNDU3MDMxIEwgMTAuNzc3MzQ0IDEuMzA4NTk0IEMgMTAuNzc3MzQ0IDAuOTE0MDYyIDEwLjc3NzM0NCAwLjA1MDc4MTIgOS45ODQzNzUgMC4wNTA3ODEyIEwgNi4yMTg3NSAwLjA3ODEyNSBDIDUuMjIyNjU2IDAuMDc4MTI1IDUuMjIyNjU2IDAuODcxMDk0IDUuMjIyNjU2IDEuMjY5NTMxIEwgNS4yMjI2NTYgNC40NDE0MDYgQyA1LjIyMjY1NiA0LjgzNTkzOCA1LjIyMjY1NiA1LjY5OTIxOSA2LjIxODc1IDUuNjk5MjE5IEwgOS45ODQzNzUgNS43MTQ4NDQgQyAxMC43NzczNDQgNS43MTQ4NDQgMTAuNzc3MzQ0IDQuODUxNTYyIDEwLjc3NzM0NCA0LjQ1NzAzMSBMIDEwLjc3NzM0NCAzLjMwODU5NCBaIE0gOC4wMDc4MTIgMTMuNTQyOTY5IEMgNy40NDkyMTkgMTMuNTQyOTY5IDcuNDQ5MjE5IDEyLjY5MTQwNiA4LjAzNTE1NiAxMi42OTE0MDYgTCAxMC43ODUxNTYgMTIuNjkxNDA2IEwgMTAuNzg1MTU2IDExLjU0Mjk2OSBDIDEwLjc4NTE1NiAxMS4xNDg0MzggMTAuNzg1MTU2IDEwLjI4NTE1NiA5Ljk5MjE4OCAxMC4yODUxNTYgTCA2LjIyNjU2MiAxMC4zMTI1IEMgNS4yMzA0NjkgMTAuMzEyNSA1LjIzMDQ2OSAxMS4xMDU0NjkgNS4yMzA0NjkgMTEuNTAzOTA2IEwgNS4yMzA0NjkgMTQuNjc1NzgxIEMgNS4yMzA0NjkgMTUuMDc0MjE5IDUuMjMwNDY5IDE1LjkzNzUgNi4yMjY1NjIgMTUuOTM3NSBMIDkuOTkyMTg4IDE1Ljk0OTIxOSBDIDEwLjc4NTE1NiAxNS45NDkyMTkgMTAuNzg1MTU2IDE1LjA4NTkzOCAxMC43ODUxNTYgMTQuNjkxNDA2IEwgMTAuNzg1MTU2IDEzLjU0Mjk2OSBaIE0gOC4wMDc4MTIgMTMuNTQyOTY5ICIgLz4KPC9zdmc+
// @description  The new and improved Tams.
// @author       MasterZeeno
// @match        https://hcc-tams.com.ph/tams*
// @grant        unsafeWindow
// @sandbox      DOM
// @grant         GM_addStyle
// @grant         GM_addElement
// @run-at       document-start
// ==/UserScript==

(function() {
  'use strict';
  
  const siteTitle = 'TamsV3';

  function showLogin() {
    processEl('span.glyphicon', ['all', 'remove']);
    processEl('.login-box-msg', 'remove');
    processEl('div.login-box div.text-center', {
      'width': '45%',
      'height': '45%',
      'text': `<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" preserveAspectRatio="xMidYmid meet" viewBox="0 0 16 16"><defs><radialGradient id="a" r="69.69%" cx="9.69%" cy="9.69%" fx="9.69%" fy="9.69%" gradientUnits="objectBoundingBox"><stop offset="0%" stop-color="var(--bs-primary-color-variant)"/><stop offset="100%" stop-color="var(--bs-primary-color)"/></radialGradient><radialGradient id="b" href="#a"><stop offset="0%" stop-color="var(--bs-alternate-color-variant)"/><stop offset="100%" stop-color="var(--bs-alternate-color)"/></radialGradient><g id="logo"><path fill="url(#a)" d="M 7.441406 9.535156 L 6.101562 9.535156 C 5.09375 9.589844 4.496094 9.761719 4.425781 11.503906 L 4.425781 15.945312 C 0.0507812 15.945312 0.0507812 15.945312 0.0507812 13.960938 L 0.0507812 2.0625 C 0.0507812 0.078125 0.0507812 0.078125 4.425781 0.078125 L 4.425781 4.511719 C 4.425781 6.144531 5.09375 6.425781 6.101562 6.484375 L 9.898438 6.484375 C 10.917969 6.40625 11.574219 6.144531 11.574219 4.515625 L 11.574219 0.078125 C 15.96875 0.078125 15.949219 0.078125 15.949219 2.0625 L 15.949219 13.960938 C 15.949219 15.945312 15.96875 15.945312 11.574219 15.945312 L 11.574219 11.503906 C 11.585938 9.761719 10.917969 9.597656 9.898438 9.535156 Z M 7.441406 9.535156 "/><path fill="url(#b)" d="M 8 3.304688 C 7.441406 3.304688 7.441406 2.460938 8.023438 2.460938 L 10.78125 2.460938 L 10.78125 1.308594 C 10.78125 0.914062 10.78125 0.0507812 9.984375 0.0507812 L 6.21875 0.078125 C 5.222656 0.078125 5.222656 0.871094 5.222656 1.269531 L 5.222656 4.441406 C 5.222656 4.839844 5.222656 5.703125 6.21875 5.703125 L 9.984375 5.714844 C 10.78125 5.714844 10.78125 4.851562 10.78125 4.453125 L 10.78125 3.304688 Z M 8.011719 13.539062 C 7.449219 13.539062 7.449219 12.695312 8.03125 12.695312 L 10.785156 12.695312 L 10.785156 11.546875 C 10.785156 11.148438 10.785156 10.285156 9.988281 10.285156 L 6.226562 10.3125 C 5.230469 10.3125 5.230469 11.109375 5.230469 11.503906 L 5.230469 14.675781 C 5.230469 15.074219 5.230469 15.9375 6.226562 15.9375 L 9.988281 15.949219 C 10.785156 15.949219 10.785156 15.089844 10.785156 14.6875 L 10.785156 13.539062 Z M 8.011719 13.539062 "/></g></defs><g transform="scale(0.5) translate(8, 8)"><g filter="brightness(132%) blur(3.2px)" opacity="0.69"><use href="#logo"></use></g><g filter="contrast(200%)"><use href="#logo"></use></g></g></svg>`
    });
    processEl('div.login-box div.login-logo a', {
      'text': siteTitle
    });
    processEl('input[name="username"]', {
      'placeholder': 'ID Number'
    });
  }

  function appendCustomConfig() {
    const baseCss = `
      <style id="zee-custom-styles">
      :root,
      :host {
          /* Primary */
          --midnight-blue-50: #def0ff;
          --midnight-blue-100: #b5ddff;
          --midnight-blue-200: #7ac6ff;
          --midnight-blue-300: #1fa6ff;
          --midnight-blue-400: #0067b6;
          --midnight-blue-500: #00387c;
          --midnight-blue-600: #00247c;
          --midnight-blue-700: #00167c;
          --midnight-blue-800: #001270;
          --midnight-blue-900: #001357;
          --midnight-blue-950: #000e3c;
          /* Primary Variant */
          --matisse-50: #eaf6ff;
          --matisse-100: #d2ebff;
          --matisse-200: #9fd8ff;
          --matisse-300: #48b9ff;
          --matisse-400: #0097f1;
          --matisse-500: #0068a5;
          --matisse-600: #00548e;
          --matisse-700: #004272;
          --matisse-800: #00375d;
          --matisse-900: #032e4f;
          --matisse-950: #021d34;
          /* Secondary */
          --thunderbird-50: #ffebeb;
          --thunderbird-100: #ffd3d3;
          --thunderbird-200: #ffaeae;
          --thunderbird-300: #ff7575;
          --thunderbird-400: #ff2727;
          --thunderbird-500: #cd0000;
          --thunderbird-600: #b20202;
          --thunderbird-700: #8f0000;
          --thunderbird-800: #7a0303;
          --thunderbird-900: #650808;
          --thunderbird-950: #380000;
          /* Secondary Variant */
          --coral-red-50: #fff1f1;
          --coral-red-100: #ffdfdf;
          --coral-red-200: #ffc5c5;
          --coral-red-300: #ff9d9d;
          --coral-red-400: #ff6464;
          --coral-red-500: #ff4d4d;
          --coral-red-600: #ed1515;
          --coral-red-700: #c80d0d;
          --coral-red-800: #a50f0f;
          --coral-red-900: #881414;
          --coral-red-950: #4b0404;
      }

      :root,
      :host {
          --bs-primary-color: var(--midnight-blue-500);
          --bs-primary-color-variant: var(--matisse-500);
          --bs-alternate-color: var(--thunderbird-500);
          --bs-alternate-color-variant: var(--coral-red-500);
          --bs-primary-default-gradient: linear-gradient(45deg, var(--midnight-blue-500), var(--midnight-blue-600));
          --bs-primary-hover-gradient: linear-gradient(45deg, var(--midnight-blue-600), var(--midnight-blue-700));
          --bs-primary-active-gradient: linear-gradient(45deg, var(--midnight-blue-700), var(--midnight-blue-800));
          --bs-white: #fff;
          --bs-black: #000;
      }

      :root,
      :host,
      [data-bs-theme="auto"],
      [data-bs-theme="light"] {
          color-scheme: light;
          --bs-logo-filter: brightness(100%);
          --bs-color: var(--bs-black);
          --bs-heading-color: var(--bs-primary-color);
          --bs-body-bg: var(--midnight-blue-50);
      }

      [data-bs-theme="dark"] {
          color-scheme: dark;
          --bs-logo-filter: brightness(169%);
          --bs-color: var(--bs-white);
          --bs-heading-color: var(--bs-white);
          --bs-body-bg: var(--midnight-blue-950);
      }

      @media (prefers-color-scheme: dark) {
          [data-bs-theme="auto"] {
              color-scheme: dark;
              --bs-logo-filter: brightness(169%);
              --bs-color: var(--bs-white);
              --bs-heading-color: var(--bs-white);
              --bs-body-bg: var(--midnight-blue-950);
          }
      }

      html,
      body {
          min-height: 100vh;
          overflow: hidden;
          font-size: 16px !important;
          background-color: var(--bs-body-bg) !important;
      }

      a {
          text-decoration: none !important;
      }

      .login-box {
         width: 280px !important;
         margin: auto;
         padding: 1.25rem;
      }

      .login-box > div {
        background-color: transparent;
      }

      #logo {
          filter: var(--bs-logo-filter) !important;
          shape-rendering: geometricPrecision !important;
      }

      button,
      input {
          border-radius: 1.5rem !important;
      }
      
      .form-control {
        color: var(--bs-heading-color) !important;
      }

      .login-logo a,
      .register-logo a {
        font-weight: 900;
        color: var(--bs-heading-color);
      }
      </style>`;
    
    const customStyles = [
      {
        selector: document.head,
        options: {
          text: `<link id="bootstrap-css" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">`
        }
      },
      {
        selector: document.head,
        options: {
          text: baseCss
        }
      },
      {
        selector: document.body,
        options: {
          text: `<script id="bootstrap-js" src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>`
        }
      }
    ];
    
    processEl(document.documentElement, {
      'data-bs-theme': 'auto'
    });
    
    customStyles.forEach(item => {
      processEl(item.selector, {'text': item.options.text, 'insert': true });
    });
    
    document.title = siteTitle;
  }

  function showOrHidePanels() {
    const currentURL = window.location.href;
    if (currentURL.includes('Auth')) {
      showLogin();
    }
  }

  function waitForElement(selector, callback) {
    const element = getElement(selector);
    if (element) {
      callback(element);
    } else {
      requestAnimationFrame(() => waitForElement(selector, callback));
    }
  }
  
    /**
   * Selects an element or elements from the DOM based on the selector.
   * @param {string} selector - The CSS selector to match elements.
   * @param {boolean} [all=false] - Whether to select all matching elements (true) or just the first one (false).
   * @returns {HTMLElement|NodeList|null} - The selected element(s), or null if no matches found.
   */
  function getElement(selector, all = false) {
    try {
      return all ? document.querySelectorAll(selector) :
        document.querySelector(selector);
    } catch (error) {
      console.error(`getElement: Invalid selector '${selector}'`, error);
      return null;
    }
  }

  /**
   * Parses various types of arguments (string, array, object) into a standardized object format.
   * @param {string|Array|string[]|Object} args - The arguments to parse.
   * @returns {Object} - The parsed arguments as an object.
   */
  function parseArgs(args) {
    if (args == null) return {};

    if (typeof args === 'string') {
      return {
        [args]: true
      };
    }

    if (Array.isArray(args)) {
      return args.reduce((acc, arg) => {
        if (typeof arg === 'string' || typeof arg === 'object') {
          return {
            ...acc,
            ...parseArgs(arg)
          };
        } else {
          console.warn(`parseArgs: Skipping invalid array element type '${typeof arg}'`);
          return acc;
        }
      }, {});
    }

    if (typeof args === 'object') {
      return args;
    }

    console.warn(`parseArgs: Unsupported argument type '${typeof args}'`);
    return {};
  }

  /**
   * Processes each element by applying a given callback function.
   * @param {HTMLElement|HTMLElement[]|NodeList} elements - The element(s) to process.
   * @param {Function} callback - The callback function to apply to each element.
   */
  function processElements(elements, callback) {
    if (!elements) return;

    if (!Array.isArray(elements) && !(elements instanceof NodeList)) {
      elements = [elements];
    }

    elements.forEach(element => {
      if (element instanceof HTMLElement) {
        try {
          callback(element);
        } catch (error) {
          console.error(`processElements: Error processing element`, error);
        }
      } else {
        console.warn(`processElements: Skipping non-HTMLElement`, element);
      }
    });
  }

  /**
   * Applies a specified attribute and value to the given elements.
   * @param {HTMLElement|HTMLElement[]} elements - The element(s) to process.
   * @param {string} attr - The attribute name to set.
   * @param {string} value - The attribute value to set.
   */
  function setAttributes(elements, attr, value) {
    const ignored = ["all", "insert", "included", "excluded"];
    if (!ignored.includes(attr)) processElements(elements, element => element.setAttribute(attr, value));
  }

  function removeElements(elements, included, excluded) {
    processElements(elements, element => {
      if (onList(element, included) && !onList(element, excluded, false)) {
        element.remove();
      }
    });
  }
  
  function onList(element, items, defaultReturn = true) {
    items = parseArgs(items);
    if (Object.keys(items).length === 0) {
      return defaultReturn;
    } else {
      const result = [];
      Object.entries(items).forEach(([key, value]) => {
        result.push(element[key].includes(value));
      });
      return result.every(Boolean);
    }
  }
  
  /**
   * Processes a DOM element or elements based on a selector or an HTML element, and options.
   * @param {string|HTMLElement} selector - The CSS selector to identify the element(s) or an HTML element.
   * @param {Object|string|Array} options - The options to apply, can be a string, an object, or an array.
   */
  function processEl(selector, ...options) {
    const opts = parseArgs(options);
    let el;

    if (typeof selector === 'string') {
      el = getElement(selector, opts.all);
    } else if (selector instanceof HTMLElement || selector instanceof HTMLCollection) {
      el = selector;
    } else {
      console.error('processEl: Invalid selector provided');
      return;
    }

    if (!el || Object.keys(opts).length === 0) {
      console.warn('processEl: No elements found or no valid options provided');
      return;
    }

    Object.entries(opts).forEach(([key, value]) => {
      if (key === 'text') {
        if (!opts.insert) {
          el.innerHTML = value;
        } else {
          el.insertAdjacentHTML('beforeend', value);
        }
      } else if (key === 'remove') {
        removeElements(el, opts.included, opts.excluded);
      } else {
        setAttributes(el, key, value);
      }
    });
  }
  
  waitForElement("head", () => {
    appendCustomConfig();
  });

  waitForElement("body", () => {
    showOrHidePanels();
  });
  
  // window.onload = (event) => {
    // processEl(document.head.children, {
      // remove: true,
      // included: {
        // href: '.css',
        // src: '.js'
      // },
      // excluded: {
        // id: 'zee',
        // id: 'bootstrap'
      // }
    // });
  // };
  
})();



